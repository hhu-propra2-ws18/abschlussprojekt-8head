<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="../static/css/navbar :: style">
	<!-- Required meta tags -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<title>Artikeldetails</title>
</head>
<body>
<nav th:replace="../static/css/navbar :: main-menu">menu</nav>
<h1 th:text="${artikel.titel}">Titel</h1>
<table id="items">
	<tr>
		<th>Beschreibung</th>
		<th>Verfügbarkeit ab</th>
		<th>Verfügbar bis</th>
		<th>Tagessatz</th>
		<th>Kaution</th>
		<th>Standort</th>
		<th>Verleihender</th>
	</tr>
	<tr>
		<td th:text="${artikel.beschreibung}">Beschreibung</td>
		<td th:text="${artikel.availableFrom.format(dateformat)}">Verfügbar ab</td>
		<td th:text="${artikel.availableTill.format(dateformat)}">Verfügbar bis</td>
		<td th:text="${artikel.tagessatz} + &euro;">Tagessatz</td>
		<td th:text="${artikel.kautionswert} + &euro;">Kaution</td>
		<td th:text="${artikel.abholort.beschreibung}">Standort</td>
		<td><a th:href="@{/profil/{besitzerId} (besitzerId=${artikel.besitzer.getId()})}"
			   th:text="|${artikel.besitzer.getVorname()} ${artikel.besitzer.getNachname()}|"><p>Name</p></a>
		</td>
	</tr>
	<tr th:if="${user.isAdmin() or user.isOwner(artikel)}">
		<form th:action="@{/details/{ArtikelId}(ArtikelId=${artikel.id})}" th:object="${artikel}" method="post">
			<td><input name="newBeschreibung" type="text" th:field="*{beschreibung}"></td>
			<td>
				<input name="newAvailableFrom" type="date" th:field="*{availableFrom}" id="availableFrom">
			</td>
			<td>
				<input name="newAvailableTill" type="date" th:field="*{availableTill}" id="availableTill">
			</td>
			<td><input name="newTagessatz" type="number" step="0.1" min="0" th:field="*{tagessatz}"></td>
			<td><input name="newKautionswert" type="number" step="0.1" min="0" th:field="*{kautionswert}"></td>
			<td><input name="newAbholortBeschreibung" type="text" th:field="*{abholort.beschreibung}"></td>
			<td><input name="newTitle" type="text" th:field="*{titel}"></td>
			<td>
				<button type="submit" value="true" name="editArtikel" >Artikel Ändern</button>
			</td>
		</form>
	</tr>
</table>

<br>
<a href="/liste">Zurück</a>
<br>
<input type="text" class="daterange"/>
<script th:inline="javascript">
	/*<![CDATA[*/
    var start_date = /*[[${artikel.getAvailableFrom().toString()}]]*/
    var end_date = /*[[${artikel.getAvailableTill().toString()}]]*/
	var some_date_range = /*[[${availabilityList}]]*/
	$('.daterange').daterangepicker({
		"minDate": start_date,
        "maxDate": end_date,
        "startDate": start_date,
        "endDate": end_date,
        "locale": {
            format: 'YYYY-MM-DD',
        },
		"isInvalidDate" : function(date){
  			for(var ii = 0; ii < some_date_range.length; ii++){
    			if (date.format('YYYY-MM-DD') == some_date_range[ii]){
    		  	return true;
    			}
  			}
		}
	});
	/*]]>*/



</script>

<img th:if="${artikel.getBase64EncodedString()!=null}"
	 th:src="@{'data:image/png;base64,'+${artikel.getBase64EncodedString()}}"/>
<div id="mapid" style="width: 600px; height: 400px;"></div>
<script th:inline="javascript">
	/*<![CDATA[*/
		var longitude = /*[[${artikel.abholort.longitude}]]*/;
		var latitude = /*[[${artikel.abholort.latitude}]]*/;
        var map = L.map('mapid').setView([latitude, longitude], 13);
        mapLink =
            '<a href="http://openstreetmap.org">OpenStreetMap</a>';
        L.tileLayer(
            'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; ' + mapLink + ' Contributors',
            maxZoom: 18,
            }).addTo(map);
		var message = /*[[${artikel.abholort.beschreibung}]]*/
		L.marker([latitude, longitude]).addTo(map)
			.bindPopup(message).openPopup();
	/*]]>*/

</script>
</body>
</html>